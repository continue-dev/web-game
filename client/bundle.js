!function(t){var i={};function s(e){if(i[e])return i[e].exports;var o=i[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=t,s.c=i,s.d=function(t,i,e){s.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:e})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,i){if(1&i&&(t=s(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(s.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var o in t)s.d(e,o,function(i){return t[i]}.bind(null,o));return e},s.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(i,"a",i),i},s.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},s.p="",s(s.s=0)}([function(t,i,s){"use strict";s.r(i);var e=function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.geometry=new THREE.BoxGeometry(.9,.9,.9),this.material=new THREE.MeshLambertMaterial({color:11184810}),this.mesh=new THREE.Mesh(this.geometry,this.material)};function o(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var n=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t)}var i,s,n;return i=t,(s=[{key:"init",value:function(t){this.cubes=[];for(var i=0;i<4;++i){for(var s=[],o=0;o<50;++o){for(var n=0,h=[],r=0;r<50;++r)h.push(new e),h[n].mesh.position.x=o,h[n].mesh.position.y=10*i,h[n].mesh.position.z=r,t.add(h[n].mesh),++n;s.push(h)}this.cubes.push(s)}this.stairs=[];for(var a=30;a<32;++a)for(var l=30;l<32;++l)this.stairs.push(new e),this.stairs[this.stairs.length-1].mesh.position.x=1.2*a,this.stairs[this.stairs.length-1].mesh.position.y=2.5,this.stairs[this.stairs.length-1].mesh.position.z=1.2*l,t.add(this.stairs[this.stairs.length-1].mesh);for(var p=28;p<30;++p)for(var c=28;c<30;++c)this.stairs.push(new e),this.stairs[this.stairs.length-1].mesh.position.x=1.2*p,this.stairs[this.stairs.length-1].mesh.position.y=5,this.stairs[this.stairs.length-1].mesh.position.z=1.2*c,t.add(this.stairs[this.stairs.length-1].mesh);for(var m=26;m<28;++m)for(var u=26;u<28;++u)this.stairs.push(new e),this.stairs[this.stairs.length-1].mesh.position.x=1.2*m,this.stairs[this.stairs.length-1].mesh.position.y=7.5,this.stairs[this.stairs.length-1].mesh.position.z=1.2*u,t.add(this.stairs[this.stairs.length-1].mesh);for(var y=30;y<32;++y)for(var d=30;d<32;++d)this.stairs.push(new e),this.stairs[this.stairs.length-1].mesh.position.x=1.2*y,this.stairs[this.stairs.length-1].mesh.position.y=12.5,this.stairs[this.stairs.length-1].mesh.position.z=1.2*d,t.add(this.stairs[this.stairs.length-1].mesh);for(var f=28;f<30;++f)for(var v=28;v<30;++v)this.stairs.push(new e),this.stairs[this.stairs.length-1].mesh.position.x=1.2*f,this.stairs[this.stairs.length-1].mesh.position.y=15,this.stairs[this.stairs.length-1].mesh.position.z=1.2*v,t.add(this.stairs[this.stairs.length-1].mesh);for(var g=26;g<28;++g)for(var x=26;x<28;++x)this.stairs.push(new e),this.stairs[this.stairs.length-1].mesh.position.x=1.2*g,this.stairs[this.stairs.length-1].mesh.position.y=17.5,this.stairs[this.stairs.length-1].mesh.position.z=1.2*x,t.add(this.stairs[this.stairs.length-1].mesh);for(var b=30;b<32;++b)for(var w=30;w<32;++w)this.stairs.push(new e),this.stairs[this.stairs.length-1].mesh.position.x=1.2*b,this.stairs[this.stairs.length-1].mesh.position.y=22.5,this.stairs[this.stairs.length-1].mesh.position.z=1.2*w,t.add(this.stairs[this.stairs.length-1].mesh);for(var z=28;z<30;++z)for(var k=28;k<30;++k)this.stairs.push(new e),this.stairs[this.stairs.length-1].mesh.position.x=1.2*z,this.stairs[this.stairs.length-1].mesh.position.y=25,this.stairs[this.stairs.length-1].mesh.position.z=1.2*k,t.add(this.stairs[this.stairs.length-1].mesh);for(var E=26;E<28;++E)for(var M=26;M<28;++M)this.stairs.push(new e),this.stairs[this.stairs.length-1].mesh.position.x=1.2*E,this.stairs[this.stairs.length-1].mesh.position.y=27.5,this.stairs[this.stairs.length-1].mesh.position.z=1.2*M,t.add(this.stairs[this.stairs.length-1].mesh);this.blocks=[];for(var P=0;P<2;++P)for(var S=0;S<2;++S)for(var C=0;C<3;++C)for(var T=0;T<3;++T)for(var K=0;K<3;++K)this.blocks.push(new e),this.blocks[this.blocks.length-1].mesh.position.x=12+1.2*C+25*P*1.2,this.blocks[this.blocks.length-1].mesh.position.y=1.2+1.2*T,this.blocks[this.blocks.length-1].mesh.position.z=12+1.2*K+25*S*1.2,t.add(this.blocks[this.blocks.length-1].mesh)}}])&&o(i.prototype,s),n&&o(i,n),t}();function h(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var r=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),this.position=new THREE.Vector3(25,4,25),this.direction=new THREE.Vector3(0,0,.1),this.cube=new e,this.cube.mesh.position.set(this.position.x,this.position.y,this.position.z),this.angle=0,this.target=new THREE.Vector3(0,0,1),this.controller=i,this.controller.handleKeyInput(),this.controller.handleMouseMove(this),this.yVelocity=0,this.gravity=-.0015,this.changeCameraFlag=!1}var i,s,o;return i=t,(s=[{key:"update",value:function(t){(this.controller.moveKeys.get(37)||this.controller.moveKeys.get(65))&&(this.angle+=1,this.direction.x=.1*Math.sin(Math.PI/180*this.angle),this.direction.z=.1*Math.cos(Math.PI/180*this.angle)),(this.controller.moveKeys.get(39)||this.controller.moveKeys.get(68))&&(this.angle-=1,this.direction.x=.1*Math.sin(Math.PI/180*this.angle),this.direction.z=.1*Math.cos(Math.PI/180*this.angle)),(this.controller.moveKeys.get(38)||this.controller.moveKeys.get(87))&&(this.position.x-=this.direction.x,this.position.z-=this.direction.z),(this.controller.moveKeys.get(40)||this.controller.moveKeys.get(83))&&(this.position.x+=this.direction.x,this.position.z+=this.direction.z),this.controller.moveKeys.get(84)&&(this.changeCameraFlag=!0),this.controller.moveKeys.get(89)&&(this.changeCameraFlag=!1),this.yVelocity+=this.gravity,this.camera.position.y+=this.yVelocity,this.position.y+=this.yVelocity;var i=Math.round(this.position.x),s=Math.round((this.position.y-2)/10),e=Math.round(this.position.z);0<i&&i<t.cubes[0].length&&0<e&&e<t.cubes[0][0].length&&(this.position.x<t.cubes[s][i][e].mesh.position.x+1&&this.position.x>t.cubes[s][i][e].mesh.position.x-1&&this.position.z<t.cubes[s][i][e].mesh.position.z+1&&this.position.z>t.cubes[s][i][e].mesh.position.z-1&&this.position.y>t.cubes[s][i][e].mesh.position.y+1&&this.position.y<t.cubes[s][i][e].mesh.position.y+9&&(this.gravity=-.0015,this.yVelocity+=this.gravity,this.position.y+=this.yVelocity,this.jumping=!1),this.position.x<t.cubes[s][i][e].mesh.position.x+1&&this.position.x>t.cubes[s][i][e].mesh.position.x-1&&this.position.y<=t.cubes[s][i][e].mesh.position.y+1&&this.position.y>t.cubes[s][i][e].mesh.position.y&&this.position.z<t.cubes[s][i][e].mesh.position.z+1&&this.position.z>t.cubes[s][i][e].mesh.position.z-1&&(this.yVelocity=0,this.position.y=t.cubes[s][i][e].mesh.position.y+1,this.jumping=!0,this.controller.moveKeys.get(32)&&this.jumping&&(this.gravity=.0015,this.yVelocity=.1,this.camera.position.y+=this.yVelocity,this.position.y+=this.yVelocity)));var o=!0,n=!1,h=void 0;try{for(var r,a=t.stairs[Symbol.iterator]();!(o=(r=a.next()).done);o=!0){var l=r.value;this.position.x<l.mesh.position.x+1&&this.position.x>l.mesh.position.x-1&&this.position.y<=l.mesh.position.y+1&&this.position.y>l.mesh.position.y&&this.position.z<l.mesh.position.z+1&&this.position.z>l.mesh.position.z-1&&(this.yVelocity=0,this.position.y=l.mesh.position.y+1,this.jumping=!0,this.controller.moveKeys.get(32)&&this.jumping&&(this.gravity=.0015,this.yVelocity=.1,this.camera.position.y+=this.yVelocity,this.position.y+=this.yVelocity))}}catch(t){n=!0,h=t}finally{try{o||null==a.return||a.return()}finally{if(n)throw h}}var p=!0,c=!1,m=void 0;try{for(var u,y=t.blocks[Symbol.iterator]();!(p=(u=y.next()).done);p=!0){var d=u.value;this.position.x<d.mesh.position.x+1.2&&this.position.x>d.mesh.position.x&&this.position.y<d.mesh.position.y+1&&this.position.y>d.mesh.position.y-1&&this.position.z<d.mesh.position.z+1&&this.position.z>d.mesh.position.z-1&&(this.position.x=d.mesh.position.x+1.2),this.position.x<d.mesh.position.x&&this.position.x>d.mesh.position.x-1.2&&this.position.y<d.mesh.position.y+1&&this.position.y>d.mesh.position.y-1&&this.position.z<d.mesh.position.z+1&&this.position.z>d.mesh.position.z-1&&(this.position.x=d.mesh.position.x-1.2),this.position.x<d.mesh.position.x+1&&this.position.x>d.mesh.position.x-1&&this.position.y<d.mesh.position.y+1&&this.position.y>d.mesh.position.y-1&&this.position.z<d.mesh.position.z+1.2&&this.position.z>d.mesh.position.z&&(this.position.z=d.mesh.position.z+1.2),this.position.x<d.mesh.position.x+1&&this.position.x>d.mesh.position.x-1&&this.position.y<d.mesh.position.y+1&&this.position.y>d.mesh.position.y-1&&this.position.z<d.mesh.position.z&&this.position.z>d.mesh.position.z-1.2&&(this.position.z=d.mesh.position.z-1.2)}}catch(t){c=!0,m=t}finally{try{p||null==y.return||y.return()}finally{if(c)throw m}}this.cube.mesh.position.set(this.position.x,this.position.y,this.position.z),this.camera.lookAt(this.position.x,this.position.y,this.position.z),this.changeCameraFlag?this.camera.position.set(this.position.x+.1*this.direction.x,this.position.y+0,this.position.z+.1*this.direction.z):this.camera.position.set(this.position.x+30*this.direction.x,this.position.y+1,this.position.z+30*this.direction.z)}}])&&h(i.prototype,s),o&&h(i,o),t}();function a(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var l=Math.PI/2,p=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.moveKeys=new Map([[37,!1],[38,!1],[39,!1],[40,!1],[87,!1],[65,!1],[83,!1],[68,!1],[32,!1],[84,!1],[89,!1]])}var i,s,e;return i=t,(s=[{key:"handleKeyInput",value:function(){var t=this;document.addEventListener("keydown",function(i){i.preventDefault(),t.moveKeys.has(i.keyCode)&&!t.moveKeys.get(i.keyCode)&&t.moveKeys.set(i.keyCode,!0)}),document.addEventListener("keyup",function(i){i.preventDefault(),t.moveKeys.has(i.keyCode)&&t.moveKeys.get(i.keyCode)&&t.moveKeys.set(i.keyCode,!1)})}},{key:"handleMouseMove",value:function(t){var i=new THREE.Euler(0,0,0,"YXZ");document.addEventListener("mousemove",function(s){i.setFromQuaternion(t.camera.quaternion),i.y-=.004*s.movementX,i.x-=.004*s.movementY,i.x=Math.max(-l,Math.min(l,i.x)),t.camera.quaternion.setFromEuler(i)})}}])&&a(i.prototype,s),e&&a(i,e),t}(),c=function t(){var i=0,s=document.createElement("div");function e(t){return s.appendChild(t.dom),t}function o(t){for(var e=0;e<s.children.length;e++)s.children[e].style.display=e===t?"block":"none";i=t}s.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",s.addEventListener("click",function(t){t.preventDefault(),o(++i%s.children.length)},!1);var n=(performance||Date).now(),h=n,r=0,a=e(new t.Panel("FPS","#0ff","#002")),l=e(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var p=e(new t.Panel("MB","#f08","#201"));return o(0),{REVISION:16,dom:s,addPanel:e,showPanel:o,begin:function(){n=(performance||Date).now()},end:function(){r++;var t=(performance||Date).now();if(l.update(t-n,200),t>=h+1e3&&(a.update(1e3*r/(t-h),100),h=t,r=0,p)){var i=performance.memory;p.update(i.usedJSHeapSize/1048576,i.jsHeapSizeLimit/1048576)}return t},update:function(){n=this.end()},domElement:s,setMode:o}};c.Panel=function(t,i,s){var e=1/0,o=0,n=Math.round,h=n(window.devicePixelRatio||1),r=80*h,a=48*h,l=3*h,p=2*h,c=3*h,m=15*h,u=74*h,y=30*h,d=document.createElement("canvas");d.width=r,d.height=a,d.style.cssText="width:80px;height:48px";var f=d.getContext("2d");return f.font="bold "+9*h+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=s,f.fillRect(0,0,r,a),f.fillStyle=i,f.fillText(t,l,p),f.fillRect(c,m,u,y),f.fillStyle=s,f.globalAlpha=.9,f.fillRect(c,m,u,y),{dom:d,update:function(a,v){e=Math.min(e,a),o=Math.max(o,a),f.fillStyle=s,f.globalAlpha=1,f.fillRect(0,0,r,m),f.fillStyle=i,f.fillText(n(a)+" "+t+" ("+n(e)+"-"+n(o)+")",l,p),f.drawImage(d,c+h,m,u-h,y,c,m,u-h,y),f.fillRect(c+u-h,m,h,y),f.fillStyle=s,f.globalAlpha=.9,f.fillRect(c+u-h,m,h,n((1-a/v)*y))}}};var m=c;function u(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var y=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.scene=new THREE.Scene,this.stage=new n,this.renderer=new THREE.WebGLRenderer({antialias:!0}),this.socket=io("/",{path:"/ws/socket.io"}),this.connected=!1,this.player=i,this.players=new Map,this.id=Math.floor(1e4*Math.random())}var i,s,o;return i=t,(s=[{key:"init",value:function(){var t=this;this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(8947712,1),document.body.appendChild(this.renderer.domElement),this.renderer.domElement.addEventListener("click",function(){t.renderer.domElement.requestPointerLock()}),this.stage.init(this.scene);var i=new THREE.DirectionalLight(16777215);i.position.set(25,1e3,25),this.scene.add(i);var s=new THREE.SpotLight(16777215,2,40,Math.PI/2,1,.5);s.position.set(25,35,25),this.scene.add(s),this.scene.add(this.player.cube.mesh),this.stats=new m,document.body.appendChild(this.stats.dom)}},{key:"connect",value:function(){var t=this;this.socket.emit("connected",{clientID:this.id,position:this.player.position}),this.socket.on("disconnect",function(){}),this.socket.on("connected",function(i){i.newUser.clientID!==t.id?t.addUser(i.newUser):(i.currentUsers.filter(function(i){return!t.players.has(i.clientID)}).forEach(function(i){t.addUser(i)}),t.connected=!0)}),this.socket.on("disconnected",function(i){var s=t.players.get(i);t.scene.remove(s.mesh),s.geometry.dispose(),s.material.dispose(),t.players.delete(i)}),this.socket.on("updatePosition",function(i){i.clientID!==t.id&&t.connected&&t.updatePosition(i)})}},{key:"addUser",value:function(t){var i=new e;i.mesh.position.x=t.position.x,i.mesh.position.y=t.position.y,i.mesh.position.z=t.position.z,this.scene.add(i.mesh),this.players.set(t.clientID,i)}},{key:"updatePosition",value:function(t){var i=this.players.get(t.clientID);i.mesh.position.x=t.position.x,i.mesh.position.y=t.position.y,i.mesh.position.z=t.position.z}},{key:"render",value:function(){this.renderer.render(this.scene,this.player.camera)}}])&&u(i.prototype,s),o&&u(i,o),t}();document.addEventListener("DOMContentLoaded",function(){var t=new y(new r(new p));t.init(),t.scene.add(t.player.camera),t.connect(),function i(){t.stats.update(),t.player.prevPos=Object.assign({},t.player.position),t.player.update(t.stage),JSON.stringify(t.player.position)!=JSON.stringify(t.player.prevPos)&&t.socket.emit("updatePosition",{clientID:t.id,position:t.player.position}),t.render(),requestAnimationFrame(i)}()})}]);
//# sourceMappingURL=bundle.js.map